# :salt: Salt-projektidokumentaatio

## :open_book: Projektin yleiskatsaus

TÃ¤ssÃ¤ dokumentissa kÃ¤sitellÃ¤Ã¤n SaltStack-konfiguraation kÃ¤yttÃ¶Ã¤ Vagrantin hallinnoimissa virtuaalikoneissa Windows-koneen PowerShellissÃ¤. KohdeympÃ¤ristÃ¶nÃ¤ ovat VirtualBoxin virtuaalikoneet, master ja minion.

### :computer: YmpÃ¤ristÃ¶

- :window: 	KÃ¤yttÃ¶jÃ¤rjestelmÃ¤ on Windows
- :package: 	Projektin hallinta Vagrantilla
- :scroll: 	Lisenssi: GNU General Public License v3
- :cd: 		Virtuaalikoneiden kÃ¤yttÃ¶jÃ¤rjestelmÃ¤: "debian/bullseye64"
- ğŸ–¥ï¸   	Virtual box virtuaalikoneiden ajamiseen

### :clock3: Projektin aikataulu
- TyÃ¶ on alkanut â²ï¸ 10:00 ğŸ“†5/9/2024
- Esivalmistelut on dokumentoitu Githubiin â²ï¸ 13:25 ğŸ“†5/9/2024
- Pohdintaa Gitbub projekti sivun pystyttÃ¤mistÃ¤ varten ja mahdollisia .sh ja .init tiedostoja varten â²ï¸ 13:30 ğŸ—“ï¸5/9/2024
- Github sivu valmiina ja ensimmÃ¤iset skriptit tehty â²ï¸ 15:44 ğŸ—“ï¸5/9/2024
- Automaation pÃ¤ivittelyÃ¤ iltaisin ajalla ğŸ—“ï¸ 5/9/2024-5/14/2024
- Projektin testailua ja pÃ¤ivittelyÃ¤ â²ï¸ 9:00 - 15:00 ğŸ—“ï¸ 5/15/2024
  
### :memo: LisÃ¤tietoja


1ï¸âƒ£ 	Tarvitset vagrantin koneelle. Asenna tÃ¤mÃ¤ omalle kÃ¤yttÃ¶jÃ¤rjestelmÃ¤llesi. (https://developer.hashicorp.com/vagrant/install)

2ï¸âƒ£ 	Tarvitset Virtual boxin millÃ¤ suoritat nÃ¤itÃ¤ virtuaalikoneita. Asenna tÃ¤mÃ¤ omalle kÃ¤yttÃ¶jÃ¤rjestelmÃ¤llesi. (https://www.virtualbox.org/wiki/Downloads)

3ï¸âƒ£	Tallenna vagrant tiedosto vagrant kansioon seuraten ohjeita vaikka Teron sivulta: https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/

# Vagrant Konfiguraatio (karvinen2017)

TÃ¤ssÃ¤ konfiguroidaan kaksi Debian Bullseye 64 -virtuaalikonetta Vagrantin avulla. 

## Vagrantfile

```ruby
# -*- mode: ruby -*-
# vi: set ft=ruby :
# Copyright 2019-2021 Tero Karvinen http://TeroKarvinen.com

$tscript = <<TSCRIPT
set -o verbose
apt-get update
apt-get -y install tree
echo "Done - set up test environment - https://terokarvinen.com/search/?q=vagrant"
TSCRIPT

Vagrant.configure("2") do |config|
	config.vm.synced_folder ".", "/vagrant", disabled: true
	config.vm.synced_folder "shared/", "/home/vagrant/shared", create: true
	config.vm.provision "shell", inline: $tscript
	config.vm.box = "debian/bullseye64"

	config.vm.define "t001" do |t001|
		t001.vm.hostname = "t001"
		t001.vm.network "private_network", ip: "192.168.88.101"
	end

	config.vm.define "t002", primary: true do |t002|
		t002.vm.hostname = "t002"
		t002.vm.network "private_network", ip: "192.168.88.102"
	end
	
end
```

4ï¸âƒ£  SaltStackin Asennus ja Konfiguraatio Windows PowershellissÃ¤

TÃ¤ssÃ¤ dokumentissa kÃ¤ydÃ¤Ã¤n lÃ¤pi, miten SaltStackin master ja minion -instanssit asennetaan ja konfiguroidaan kÃ¤yttÃ¤en kahta erillistÃ¤ Windows PowershelliÃ¤, joissa on jÃ¤rjestelmÃ¤nvalvojan oikeudet.

## YmpÃ¤ristÃ¶n Pystytys

1. **Avaa kaksi Powershell-ikkunaa** Windowsissa jÃ¤rjestelmÃ¤nvalvojan oikeuksilla.
2. **KÃ¤ynnistÃ¤ virtuaalikoneet** YhdessÃ¤ Powershell-ikkunassa kÃ¤yttÃ¤en komentoa:
   ```bash
   vagrant up
**YhdistÃ¤ t001-koneeseen ensimmÃ¤isestÃ¤ Powershell-ikkunasta:**
```bash
vagrant ssh t001
```
**YhdistÃ¤ t002-koneeseen toisesta Powershell-ikkunasta:**
```bash
vagrant ssh t002
```
**Suorita kummallakin virtuaalikoneella seuraava komento pÃ¤ivittÃ¤Ã¤ksesi pakettilistat:**
```sudo apt-get update```

**Asenna Salt Master t001-koneelle kÃ¤yttÃ¤en komentoa:**
```sudo apt-get -y install salt-master```

**Asenna Salt Minion t002-koneelle kÃ¤yttÃ¤en komentoa:**
```sudo apt-get -y install salt-minion```

**Muokkaa salt-minion konfiguraatiotiedostoa t002-koneella kÃ¤yttÃ¤en komentoa:**
```sudo nano /etc/salt/minion```

**LisÃ¤Ã¤ tiedostoon masterin IP-osoite: master: 192.168.88.101**
**Tallenna tiedosto ja poistu nano-editorista painamalla Ctrl+X, vahvista tallennus Y-nÃ¤ppÃ¤imellÃ¤ ja poistu Enter-nÃ¤ppÃ¤imellÃ¤.
KÃ¤ynnistÃ¤ Salt Minion uudelleen kÃ¤yttÃ¤en komentoa: sudo systemctl restart salt-minion**

![Nanolla lisÃ¤tÃ¤Ã¤n Masterin osoite minionille](https://github.com/Linux88888/Palvelintenhallinta/assets/143414956/62e76075-0e2a-47ad-86a2-3d6887ca04b5)

(Nanolla lisÃ¤tÃ¤Ã¤n Masterin osoite minionille yllÃ¤ olevassa kuvassa.)

**Tarkista odottavat avaimet t001-koneella kÃ¤yttÃ¤en komentoa:**
```sudo salt-key -L```

**HyvÃ¤ksy odottavat avaimet kÃ¤yttÃ¤en komentoa:**
```sudo salt-key -A'```

![Odottava avain hyvÃ¤ksytty](https://github.com/Linux88888/Palvelintenhallinta/assets/143414956/785ef675-09ba-4eb2-8101-10b440a1bb4d)

(Odottava avain hyvÃ¤ksytty yllÃ¤ olevassa kuvassa.)

**Varmista vielÃ¤ ettÃ¤ yhteys toimii. Testaa masterin yhteys minioniin komennolla:**
```sudo salt '*' cmd.run 'whoami'```

**TÃ¤mÃ¤n pitÃ¤isi saada vastaus t002: root**


# Automatisointi
**Hienoa sait manuaalisesti orja ja omistaja jÃ¤rjestelmÃ¤n toimimaan. Seuraavaksi on tarkoitus automatisoida tÃ¤mÃ¤.**

**KÃ¤ytÃ¤ siis komentoa:**

```vagrant destroy```
```vagrant up```

Powershell 1 omistaja:```vagrant ssh t001```

Powershell 2 orja:```vagrant ssh t002```

Powershell 1 omistaja: ```wget https://raw.githubusercontent.com/Linux88888/Palvelintenhallinta2024Projekti/main/Skriptit/master.sh -O master.sh && chmod +x master.sh && ./master.sh```

Powershell 2 orja:```wget https://raw.githubusercontent.com/Linux88888/Palvelintenhallinta2024Projekti/main/Skriptit/minion.sh -O minion.sh && chmod +x minion.sh && ./minion.sh```


![image](https://github.com/Linux88888/Palvelintenhallinta/assets/143414956/3f99a4bf-1a37-4a1f-b348-f629f3e03ec3)

Tila on ajettu onnistuneesti. EdellÃ¤ ajettiin t002 koneelle seuraavat ohjelmat:  
	git
      	nodejs
      	npm
      	apache2
      	docker.io
      	postgresql
      	php
      	php-mysql
      	libapache2-mod-php

LÃ¤hteet:
- [https://terokarvinen.com/2017/provision-multiple-virtual-puppet-slaves-with-vagrant/](https://terokarvinen.com/2021/two-machine-virtual-network-with-debian-11-bullseye-and-vagrant/)
- https://developer.hashicorp.com/vagrant/install
- https://www.virtualbox.org/wiki/Downloads
- https://stackoverflow.com/questions/39065921/what-do-raw-githubusercontent-com-urls-represent
  
